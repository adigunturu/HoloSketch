import * as TWEEN from '@tweenjs/tween.js'
import { useEffect, useRef, useState } from 'react';
import * as THREE from 'three';
import * as React from 'react';
import { useFrame } from '@react-three/fiber'

export default function TweenExp() {
    let points = [
        [
            0,
            0.8745358515165212,
            1.2994931464539166
        ],
        [
            0,
            0.8745358515165212,
            1.2994931464539166
        ],
        [
            0,
            0.8870292208238999,
            1.2994931464539166
        ],
        [
            0,
            0.8870292208238999,
            1.2994931464539166
        ],
        [
            0,
            0.9245093287460366,
            1.2994931464539166
        ],
        [
            0,
            0.9245093287460366,
            1.2994931464539166
        ],
        [
            0,
            0.986976175282931,
            1.2994931464539166
        ],
        [
            0,
            0.986976175282931,
            1.2994931464539166
        ],
        [
            0,
            1.0494430218198256,
            1.2994931464539166
        ],
        [
            0,
            1.0494430218198256,
            1.2994931464539166
        ],
        [
            0,
            1.1493899762788562,
            1.2994931464539166
        ],
        [
            0,
            1.1493899762788562,
            1.2994931464539166
        ],
        [
            0,
            1.2243501921231297,
            1.2745028936374951
        ],
        [
            0,
            1.2243501921231297,
            1.2745028936374951
        ],
        [
            0,
            1.2868170386600237,
            1.2620077672292849
        ],
        [
            0,
            1.2868170386600237,
            1.2620077672292849
        ],
        [
            0,
            1.3617772545042972,
            1.2495126408210737
        ],
        [
            0,
            1.3617772545042972,
            1.2495126408210737
        ],
        [
            0,
            1.4492308396559495,
            1.2370175144128632
        ],
        [
            0,
            1.4492308396559495,
            1.2370175144128632
        ],
        [
            0,
            1.4867109475780862,
            1.2245223880046523
        ],
        [
            0,
            1.4867109475780862,
            1.2245223880046523
        ],
        [
            0,
            1.5241910555002225,
            1.2245223880046523
        ],
        [
            0,
            1.5241910555002225,
            1.2245223880046523
        ],
        [
            0,
            1.5616711634223592,
            1.2245223880046523
        ],
        [
            0,
            1.5616711634223592,
            1.2245223880046523
        ],
        [
            0,
            1.5741645327297382,
            1.2245223880046523
        ],
        [
            0,
            1.5741645327297382,
            1.2245223880046523
        ],
        [
            0,
            1.5741645327297382,
            1.2120272615964418
        ],
        [
            0,
            1.5741645327297382,
            1.2120272615964418
        ],
        [
            0,
            1.5366844248076015,
            1.1745418823718092
        ],
        [
            0,
            1.5366844248076015,
            1.1745418823718092
        ],
        [
            0,
            1.474217578270707,
            1.1245613767389664
        ],
        [
            0,
            1.474217578270707,
            1.1245613767389664
        ],
        [
            0,
            1.4242441010411917,
            1.0870759975143345
        ],
        [
            0,
            1.4242441010411917,
            1.0870759975143345
        ],
        [
            0,
            1.3492838851969182,
            1.0370954918814916
        ],
        [
            0,
            1.3492838851969182,
            1.0370954918814916
        ],
        [
            0,
            1.2868170386600237,
            0.9871149862486486
        ],
        [
            0,
            1.2868170386600237,
            0.9871149862486486
        ],
        [
            0,
            1.2243501921231297,
            0.9621247334322272
        ],
        [
            0,
            1.2243501921231297,
            0.9621247334322272
        ],
        [
            0,
            1.174376714893614,
            0.9371344806158056
        ],
        [
            0,
            1.174376714893614,
            0.9371344806158056
        ],
        [
            0,
            1.1368966069714777,
            0.9121442277993842
        ],
        [
            0,
            1.1368966069714777,
            0.9121442277993842
        ],
        [
            0,
            1.099416499049341,
            0.9121442277993842
        ],
        [
            0,
            1.099416499049341,
            0.9121442277993842
        ],
        [
            0,
            1.0494430218198256,
            0.899649101391173
        ],
        [
            0,
            1.0494430218198256,
            0.899649101391173
        ],
        [
            0,
            0.9994695445903097,
            0.8746588485747516
        ],
        [
            0,
            0.9994695445903097,
            0.8746588485747516
        ],
        [
            0,
            0.9494960673607943,
            0.8371734693501197
        ],
        [
            0,
            0.9494960673607943,
            0.8371734693501197
        ],
        [
            0,
            0.9245093287460366,
            0.8371734693501197
        ],
        [
            0,
            0.9245093287460366,
            0.8371734693501197
        ],
        [
            0,
            0.899522590131279,
            0.8246783429419087
        ],
        [
            0,
            0.899522590131279,
            0.8246783429419087
        ],
        [
            0,
            0.8870292208238999,
            0.8121832165336983
        ],
        [
            0,
            0.8870292208238999,
            0.8121832165336983
        ],
        [
            0,
            0.8745358515165212,
            0.8121832165336983
        ],
        [
            0,
            0.8745358515165212,
            0.8121832165336983
        ],
        [
            0,
            0.8745358515165212,
            0.8371734693501197
        ],
        [
            0,
            0.8745358515165212,
            0.8371734693501197
        ],
        [
            0,
            0.8870292208238999,
            1.062085744697913
        ],
        [
            0,
            0.8870292208238999,
            1.062085744697913
        ],
        [
            0,
            0.8870292208238999,
            1.112066250330756
        ],
        [
            0,
            0.8870292208238999,
            1.112066250330756
        ],
        [
            0,
            0.899522590131279,
            1.1495516295553878
        ],
        [
            0,
            0.899522590131279,
            1.1495516295553878
        ],
        [
            0,
            0.899522590131279,
            1.2120272615964418
        ],
        [
            0,
            0.899522590131279,
            1.2120272615964418
        ],
        [
            0,
            0.899522590131279,
            1.2245223880046523
        ],
        [
            0,
            0.899522590131279,
            1.2245223880046523
        ],
        [
            0,
            0.9120159594386575,
            1.2495126408210737
        ],
        [
            0,
            0.9120159594386575,
            1.2495126408210737
        ],
        [
            0,
            0.9120159594386575,
            1.2745028936374951
        ],
        [
            0,
            0.9120159594386575,
            1.2745028936374951
        ],
        [
            0,
            0.9245093287460366,
            1.2745028936374951
        ],
        [
            0,
            0.9245093287460366,
            1.2745028936374951
        ],
        [
            0,
            0.9245093287460366,
            1.2869980200457063
        ],
        [
            0,
            0.9245093287460366,
            1.2869980200457063
        ],
        [
            0,
            0.9245093287460366,
            1.2994931464539166
        ],
        [
            0,
            0.9245093287460366,
            1.2994931464539166
        ],
        [
            0,
            0.9370026980534157,
            1.3119882728621277
        ]
    ]
    let points2 = [
        [
            -0.01769722569495258,
            1.5723036891241409,
            0.5670384568930743
        ],
        [
            -0.01769722569495258,
            1.5723036891241409,
            0.5670384568930743
        ],
        [
            -0.01856978315881541,
            1.4568548168457947,
            0.5504021802648417
        ],
        [
            -0.01856978315881541,
            1.4568548168457947,
            0.5504021802648417
        ],
        [
            -0.018713280944341548,
            1.4018791633799155,
            0.5393494015840393
        ],
        [
            -0.018713280944341548,
            1.4018791633799155,
            0.5393494015840393
        ],
        [
            -0.018565926241910446,
            1.385386467340152,
            0.5338420484459812
        ],
        [
            -0.018565926241910446,
            1.385386467340152,
            0.5338420484459812
        ],
        [
            -0.01911368522989143,
            1.3578986406072124,
            0.533794457940124
        ],
        [
            -0.01911368522989143,
            1.3578986406072124,
            0.533794457940124
        ],
        [
            -0.019294985920250696,
            1.324913248527685,
            0.5282585504985512
        ],
        [
            -0.019294985920250696,
            1.324913248527685,
            0.5282585504985512
        ],
        [
            -0.019257183015417567,
            1.3029229871413333,
            0.5227416792593215
        ],
        [
            -0.019257183015417567,
            1.3029229871413333,
            0.5227416792593215
        ],
        [
            -0.01900027651539027,
            1.2919278564481576,
            0.5172438442224343
        ],
        [
            -0.01900027651539027,
            1.2919278564481576,
            0.5172438442224343
        ],
        [
            -0.01896247361055714,
            1.2699375950618057,
            0.5117269729832048
        ],
        [
            -0.01896247361055714,
            1.2699375950618057,
            0.5117269729832048
        ],
        [
            -0.01892467070572401,
            1.2479473336754545,
            0.5062101017439747
        ],
        [
            -0.01892467070572401,
            1.2479473336754545,
            0.5062101017439747
        ],
        [
            -0.01921552319368125,
            1.2094643762493391,
            0.5006646762012305
        ],
        [
            -0.01921552319368125,
            1.2094643762493391,
            0.5006646762012305
        ],
        [
            -0.019544178586466288,
            1.1929716802095753,
            0.5006361218977164
        ],
        [
            -0.019544178586466288,
            1.1929716802095753,
            0.5006361218977164
        ],
        [
            -0.019982385776851075,
            1.1709814188232237,
            0.500598049493031
        ],
        [
            -0.019982385776851075,
            1.1709814188232237,
            0.500598049493031
        ],
        [
            -0.019687676371992424,
            1.1379960267436964,
            0.489583343216914
        ],
        [
            -0.019687676371992424,
            1.1379960267436964,
            0.489583343216914
        ],
        [
            -0.02034498715756783,
            1.1050106346641688,
            0.48952623460988565
        ],
        [
            -0.02034498715756783,
            1.1050106346641688,
            0.48952623460988565
        ],
        [
            -0.020307184252736477,
            1.0830203732778174,
            0.4840093633706556
        ],
        [
            -0.020307184252736477,
            1.0830203732778174,
            0.4840093633706556
        ],
        [
            -0.02026938134790157,
            1.0610301118914658,
            0.47849249213142586
        ],
        [
            -0.02026938134790157,
            1.0610301118914658,
            0.47849249213142586
        ],
        [
            -0.0198651201454485,
            1.033542285158526,
            0.4674873039564801
        ],
        [
            -0.0198651201454485,
            1.033542285158526,
            0.4674873039564801
        ],
        [
            -0.020084223740639118,
            1.0225471544653504,
            0.4674682677541374
        ],
        [
            -0.020084223740639118,
            1.0225471544653504,
            0.4674682677541374
        ],
        [
            -0.019827317240613596,
            1.0115520237721745,
            0.46197043271725036
        ],
        [
            -0.019827317240613596,
            1.0115520237721745,
            0.46197043271725036
        ],
        [
            -0.02004642083580599,
            1.0005568930789988,
            0.46195139651490746
        ],
        [
            -0.02004642083580599,
            1.0005568930789988,
            0.46195139651490746
        ],
        [
            -0.019203952442966354,
            0.9950593277324109,
            0.4509842807446477
        ],
        [
            -0.019203952442966354,
            0.9950593277324109,
            0.4509842807446477
        ],
        [
            -0.01836148405012672,
            0.989561762385823,
            0.4400171649743877
        ],
        [
            -0.01836148405012672,
            0.989561762385823,
            0.4400171649743877
        ],
        [
            -0.017409463859692664,
            0.989561762385823,
            0.42905956730529915
        ],
        [
            -0.017409463859692664,
            0.989561762385823,
            0.42905956730529915
        ],
        [
            -0.01656699546685303,
            0.9840641970392352,
            0.4180924515350394
        ],
        [
            -0.01656699546685303,
            0.9840641970392352,
            0.4180924515350394
        ],
        [
            -0.015248516978793702,
            0.978566631692647,
            0.40164653693023555
        ],
        [
            -0.015248516978793702,
            0.978566631692647,
            0.40164653693023555
        ],
        [
            -0.010597967824214294,
            0.973069066346059,
            0.3468490304836217
        ],
        [
            -0.010597967824214294,
            0.973069066346059,
            0.3468490304836217
        ],
        [
            -0.0044098365863831646,
            0.973069066346059,
            0.2756246456345467
        ],
        [
            -0.0044098365863831646,
            0.973069066346059,
            0.2756246456345467
        ],
        [
            0.0002029096633648919,
            0.989561762385823,
            0.2263440104271629
        ],
        [
            0.0002029096633648919,
            0.989561762385823,
            0.2263440104271629
        ],
        [
            0.0035349803298885263,
            0.989561762385823,
            0.1879924185853531
        ],
        [
            0.0035349803298885263,
            0.989561762385823,
            0.1879924185853531
        ],
        [
            0.005915030805976329,
            0.989561762385823,
            0.16059842441263206
        ],
        [
            0.005915030805976329,
            0.989561762385823,
            0.16059842441263206
        ],
        [
            0.011627151948589542,
            0.989561762385823,
            0.09485283839810144
        ],
        [
            0.011627151948589542,
            0.989561762385823,
            0.09485283839810144
        ],
        [
            0.017448824888797176,
            0.9950593277324109,
            0.029116770484741816
        ],
        [
            0.017448824888797176,
            0.9950593277324109,
            0.029116770484741816
        ],
        [
            0.021842467543354616,
            1.0005568930789988,
            -0.02018290092498476
        ],
        [
            0.021842467543354616,
            1.0005568930789988,
            -0.02018290092498476
        ],
        [
            0.025284090007474447,
            1.0060544584255866,
            -0.0585249746656229
        ],
        [
            0.025284090007474447,
            1.0060544584255866,
            -0.0585249746656229
        ],
        [
            0.029201722566812194,
            1.0115520237721745,
            -0.10234584724080531
        ],
        [
            0.029201722566812194,
            1.0115520237721745,
            -0.10234584724080531
        ],
        [
            0.02931127436440839,
            1.0170495891187623,
            -0.10233632913963397
        ],
        [
            0.02931127436440839,
            1.0170495891187623,
            -0.10233632913963397
        ],
        [
            0.029420826162004587,
            1.0225471544653502,
            -0.10232681103846242
        ],
        [
            0.029420826162004587,
            1.0225471544653502,
            -0.10232681103846242
        ],
        [
            0.029273471459573486,
            1.0390398505051144,
            -0.09681945790040458
        ],
        [
            0.029273471459573486,
            1.0390398505051144,
            -0.09681945790040458
        ],
        [
            0.028940959149881706,
            1.0940155039709931,
            -0.0802878803850573
        ],
        [
            0.028940959149881706,
            1.0940155039709931,
            -0.0802878803850573
        ],
        [
            0.029923068411340736,
            1.2149619415959272,
            -0.0636420856556541
        ],
        [
            0.029923068411340736,
            1.2149619415959272,
            -0.0636420856556541
        ],
        [
            0.03145679357768749,
            1.2919278564481576,
            -0.06350883223925408
        ],
        [
            0.03145679357768749,
            1.2919278564481576,
            -0.06350883223925408
        ],
        [
            0.03145293666078253,
            1.3633962059538005,
            -0.04694870042039334
        ]
    ];

    const [geo1,setGeo1] = useState(getGeometry(points));
    const [geo2,setGeo2] = useState(getGeometry(points2));
    const [geonew,setGeonew] = useState(getGeometry(points));
    const [theta,setTheta] = useState(0);
    const myMesh =  useRef<THREE.Mesh>(null!);
    const mesh2 =  useRef<THREE.Mesh>(null!);
    const meshNew =  useRef<THREE.Mesh>(null!);
    useFrame(({clock}) => {
        let tempTheta = theta + 0.06
        setTheta(tempTheta);
        let amt = (Math.sin(tempTheta) + 1) / 2;

        let lerpedPoints = []
        for (let i = 0; i < points.length; i++) {
            let cv = points[i];
            let tv = points2[i];
            let x = THREE.MathUtils.lerp(cv[0], tv[0], amt);
            let y = THREE.MathUtils.lerp(cv[1], tv[1], amt);
            let z = THREE.MathUtils.lerp(cv[2], tv[2], amt);
            lerpedPoints.push([x,y,z])
        }
            setGeonew(getGeometry(lerpedPoints))
    });
    // const tween = new TWEEN.Tween({x:0})
    // useEffect(()=>{
    //     tween.to({x:5}, 2000)
    //     tween.start()
    //     tween.repeat(Infinity)
    //     tween.onUpdate((coords)=>{
            
    //     });
    // },[])
    

    return (
    <>
    <mesh ref={myMesh} castShadow={true} receiveShadow={true} frustumCulled={true} geometry={geo1.geometry} material={geo1.material}/>
    <mesh ref={mesh2} castShadow={true} receiveShadow={true} frustumCulled={true} geometry={geo2.geometry} material={geo2.material}/>
    <mesh ref={meshNew} castShadow={true} receiveShadow={true} frustumCulled={true} geometry={geonew.geometry} material={geonew.material}/>
    </>
    )

}

function getGeometry(points:number[][]){
    const mappedPoints = points.map(pt => new THREE.Vector3(...pt));
    let filteredPoints;
    if (points.length < 1) {
        filteredPoints = mappedPoints
    } else {
        filteredPoints = mappedPoints
            .filter((v, i) => {
                return i % 3 === 0
            });
    }
    const curve = new THREE.CatmullRomCurve3(filteredPoints, false, 'centripetal', 0);
    let geometry = new THREE.TubeGeometry(curve, points.length, 0.04, 20);
    const material = new THREE.MeshPhongMaterial({ color: 0xffffff, side: THREE.DoubleSide });
    return {geometry, material}
}